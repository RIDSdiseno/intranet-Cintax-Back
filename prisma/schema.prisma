generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Trabajador {
  id_trabajador      Int              @id @default(autoincrement())
  nombre             String
  email              String           @unique
  passwordHash       String?
  googleId           String?          @unique
  status             Boolean          @default(true)
  createdAt          DateTime         @default(now())
  googleRefreshToken String?
  areaInterna        Area?
  lastActivityAt     DateTime?
  tipoRelacion       TipoRelacion?
  refreshTokens      RefreshToken[]
  tareasAsignadas    TareaAsignada[]  @relation("TrabajadorTareas")
  tareasDefault      TareaPlantilla[] @relation("TareaResponsableDefault")
  tickets            Ticket[]
}

model RefreshToken {
  id           Int        @id @default(autoincrement())
  tokenHash    String
  expiresAt    DateTime
  createdAt    DateTime   @default(now())
  trabajadorId Int
  trabajador   Trabajador @relation(fields: [trabajadorId], references: [id_trabajador], onDelete: Cascade)
}

model Ticket {
  id_ticket      Int         @id @default(autoincrement())
  subject        String
  description    String
  categoria      String
  estado         String
  prioridad      Int?
  requesterEmail String
  freshdeskId    Int?        @unique
  trabajadorId   Int?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  trabajador     Trabajador? @relation(fields: [trabajadorId], references: [id_trabajador])
}

model TareaPlantilla {
  id_tarea_plantilla   Int             @id @default(autoincrement())
  area                 Area
  nombre               String
  detalle              String
  frecuenciaTexto      String?
  plazoMaximoTexto     String?
  frecuencia           FrecuenciaTarea
  diaMesVencimiento    Int?
  diaSemanaVencimiento Int?
  presentacion         Presentacion
  activo               Boolean         @default(true)
  responsableDefaultId Int?
  tareasAsignadas      TareaAsignada[]
  responsableDefault   Trabajador?     @relation("TareaResponsableDefault", fields: [responsableDefaultId], references: [id_trabajador])
}

model TareaAsignada {
  id_tarea_asignada Int            @id @default(autoincrement())
  tareaPlantillaId  Int
  trabajadorId      Int?
  estado            EstadoTarea    @default(PENDIENTE)
  fechaProgramada   DateTime
  fechaComplecion   DateTime?
  comentarios       String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  tareaPlantilla    TareaPlantilla @relation(fields: [tareaPlantillaId], references: [id_tarea_plantilla])
  asignado          Trabajador?    @relation("TrabajadorTareas", fields: [trabajadorId], references: [id_trabajador])
}

enum Area {
  CONTA
  ADMIN
  RRHH
  TRIBUTARIO
}

enum Presentacion {
  CLIENTE
  INTERNO
}

enum EstadoTarea {
  PENDIENTE
  EN_PROCESO
  COMPLETADA
  VENCIDA
}

enum FrecuenciaTarea {
  MENSUAL
  SEMANAL
  UNICA
}

enum TipoRelacion {
  CLIENTES
  PROVEEDORES
  INTERNO
}
